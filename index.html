<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Gil Bato vs Ralph Macchio</title>
<style>
  body { margin:0; background:#111; }
  canvas { display:block; margin:0 auto; background:#000; }
</style>
</head>
<body>
<canvas id="game" width="1100" height="620"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

ctx.font = "18px Arial";
ctx.textBaseline = "alphabetic";

const W = canvas.width;
const H = canvas.height;
const ground = 520;

const bg = new Image();
bg.src = "bg.png";

const keys = Object.create(null);
addEventListener("keydown", (e) => {
  keys[e.key] = true;
  if (e.key === "r" || e.key === "R") reset();
  if (["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"," "].includes(e.key)) e.preventDefault();
}, { passive:false });
addEventListener("keyup", (e) => keys[e.key] = false);

function clamp(v, a, b) { return Math.max(a, Math.min(b, v)); }
function hit(a, b) {
  return a.x < b.x + b.w && a.x + a.w > b.x && a.y < b.y + b.h && a.y + a.h > b.y;
}

function makeFighter(name, x, color, controls) {
  return {
    name,
    x,
    y: ground - 120,
    w: 64,
    h: 120,
    color,
    hp: 100,
    vx: 0,
    vy: 0,
    onGround: true,
    face: 1,
    controls,
    cooldown: 0,
    stun: 0,
    attack: null,   // { type:"punch"|"kick", t:number, didHit:boolean }
  };
}

const p1 = makeFighter("GIL BATO", 220, "#9a4f00", {
  left: "a",
  right: "d",
  jump: "w",
  punch: "f",
  kick: "g"
});

const p2 = makeFighter("RALPH MACCHIO", 820, "#ffffff", {
  left: "ArrowLeft",
  right: "ArrowRight",
  jump: "ArrowUp",
  punch: "k",
  kick: "l"
});

function reset() {
  p1.x = 220; p1.y = ground - p1.h; p1.hp = 100; p1.vx = 0; p1.vy = 0; p1.onGround = true; p1.cooldown = 0; p1.stun = 0; p1.attack = null;
  p2.x = 820; p2.y = ground - p2.h; p2.hp = 100; p2.vx = 0; p2.vy = 0; p2.onGround = true; p2.cooldown = 0; p2.stun = 0; p2.attack = null;
}

function drawHealth(x, y, hp, name, alignRight) {
  const barW = 360;
  const barH = 18;

  ctx.fillStyle = "rgba(0,0,0,0.55)";
  ctx.fillRect(x - 6, y - 24, barW + 12, 56);

  ctx.fillStyle = "#fff";
  ctx.fillText(name, x, y - 6);

  ctx.fillStyle = "#333";
  ctx.fillRect(x, y, barW, barH);

  const w = clamp(hp, 0, 100) / 100 * barW;
  ctx.fillStyle = "#00ff00";
  ctx.fillRect(x, y, w, barH);

  // Optional small markers
  ctx.fillStyle = "rgba(255,255,255,0.35)";
  for (let i = 1; i <= 9; i++) ctx.fillRect(x + i*(barW/10), y, 1, barH);
}

function startAttack(p, type) {
  if (p.hp <= 0) return;
  if (p.stun > 0) return;
  if (p.attack) return;
  if (p.cooldown > 0) return;

  p.attack = { type, t: 0, didHit: false };
  p.cooldown = type === "kick" ? 28 : 22; // frames at ~60fps
}

function attackHitbox(p) {
  const type = p.attack?.type || "punch";
  const reach = type === "kick" ? 64 : 48;
  const hbW = reach;
  const hbH = type === "kick" ? 26 : 18;
  const hbX = p.face === 1 ? (p.x + p.w) : (p.x - hbW);
  const hbY = p.y + (type === "kick" ? 62 : 52);
  return { x: hbX, y: hbY, w: hbW, h: hbH };
}

function applyHit(attacker, defender, type) {
  const dmg = type === "kick" ? 14 : 10;
  defender.hp = clamp(defender.hp - dmg, 0, 100);

  defender.stun = 10; // frames
  const push = type === "kick" ? 36 : 28;
  defender.x += attacker.face * push;
  defender.x = clamp(defender.x, 0, W - defender.w);
}

function updateFighter(p, opp) {
  // Face opponent
  p.face = (opp.x + opp.w/2) >= (p.x + p.w/2) ? 1 : -1;

  // Timers
  if (p.cooldown > 0) p.cooldown -= 1;
  if (p.stun > 0) p.stun -= 1;

  // Stop input after KO
  if (p.hp <= 0) {
    p.vx *= 0.85;
    return;
  }

  const speed = 220;
  const jumpV = -520;
  const gravity = 1500;

  let move = 0;
  const leftDown = !!keys[p.controls.left];
  const rightDown = !!keys[p.controls.right];
  const jumpDown = !!keys[p.controls.jump];

  if (p.stun <= 0) {
    if (leftDown) move -= 1;
    if (rightDown) move += 1;
  }

  p.vx = move * speed;

  if (p.stun <= 0 && jumpDown && p.onGround) {
    p.vy = jumpV;
    p.onGround = false;
  }

  if (keys[p.controls.punch]) startAttack(p, "punch");
  if (keys[p.controls.kick]) startAttack(p, "kick");

  // Physics
  p.vy += gravity * (1/60);
  p.x += p.vx * (1/60);
  p.y += p.vy * (1/60);

  // Ground
  if (p.y + p.h >= ground) {
    p.y = ground - p.h;
    p.vy = 0;
    p.onGround = true;
  }

  // Bounds
  p.x = clamp(p.x, 0, W - p.w);

  // Attack timing
  if (p.attack) {
    p.attack.t += 1; // frames
    const activeStart = 6;                         // ~0.10s
    const activeEnd = p.attack.type === "kick" ? 18 : 14;
    const end = p.attack.type === "kick" ? 26 : 22;

    if (!p.attack.didHit && p.attack.t >= activeStart && p.attack.t <= activeEnd) {
      const hb = attackHitbox(p);
      if (hit(hb, opp) && opp.hp > 0) {
        p.attack.didHit = true;
        applyHit(p, opp, p.attack.type);
      }
    }

    if (p.attack.t >= end) p.attack = null;
  }
}

function drawBackground() {
  ctx.fillStyle = "#222";
  ctx.fillRect(0, 0, W, H);

  if (bg.complete && bg.naturalWidth > 0) {
    ctx.drawImage(bg, 0, 0, W, H);
  } else {
    ctx.fillStyle = "#fff";
    ctx.fillText("Loading bg.png...", 20, 40);
  }
}

function drawFighter(p) {
  ctx.fillStyle = p.color;
  ctx.fillRect(p.x, p.y, p.w, p.h);

  // Simple head marker
  ctx.fillStyle = "rgba(0,0,0,0.35)";
  ctx.fillRect(p.x + 18, p.y + 10, 28, 24);

  // Attack hitbox overlay
  if (p.attack) {
    const hb = attackHitbox(p);
    ctx.fillStyle = "rgba(255,0,0,0.4)";
    ctx.fillRect(hb.x, hb.y, hb.w, hb.h);
  }

  // Stun marker
  if (p.stun > 0) {
    ctx.fillStyle = "rgba(255,255,0,0.5)";
    ctx.fillRect(p.x, p.y - 10, p.w, 6);
  }
}

function drawUI() {
  drawHealth(40, 46, p1.hp, p1.name, false);
  drawHealth(W - 40 - 360, 46, p2.hp, p2.name, true);

  ctx.fillStyle = "rgba(0,0,0,0.55)";
  ctx.fillRect(40, H - 44, W - 80, 28);
  ctx.fillStyle = "#fff";
  ctx.fillText("Gil: A/D move, W jump, F punch, G kick.  Ralph: ◀/▶ move, ▲ jump, K punch, L kick.  R restart.", 54, H - 24);
}

function drawKO() {
  if (p1.hp > 0 && p2.hp > 0) return;

  ctx.fillStyle = "rgba(0,0,0,0.6)";
  ctx.fillRect(0, 0, W, H);

  ctx.fillStyle = "#fff";
  ctx.font = "56px Arial";
  ctx.fillText("KO", W/2 - 40, H/2 - 10);

  ctx.font = "22px Arial";
  const winner = p1.hp <= 0 ? p2.name : p1.name;
  ctx.fillText(winner + " WINS", W/2 - 100, H/2 + 34);
  ctx.fillText("Press R to restart", W/2 - 105, H/2 + 70);

  ctx.font = "18px Arial";
}

function loop() {
  // Update
  if (p1.hp > 0 && p2.hp > 0) {
    updateFighter(p1, p2);
    updateFighter(p2, p1);
  }

  // Draw
  drawBackground();
  drawFighter(p1);
  drawFighter(p2);
  drawUI();
  drawKO();

  requestAnimationFrame(loop);
}

requestAnimationFrame(loop);
</script>
</body>
</html>



